<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Support <%= company.name %> through donations, volunteering, or partnerships to help bridge the digital divide.">
    <title>Support Us - <%= company.name %></title>
    <link rel="stylesheet" href="./public/css/main.css">
    <%- include('partials/favicon-stylesheet') %>
</head>
<body>

<%- include('partials/jumbotron') %>
<%- include('partials/navbar') %>

<main class="container my-5">
    <h2 class="text-center mb-4">Available Stock</h2>
    <div class="row">
        <!-- Desktops Section -->
        <div class="col-md-6">
            <h3 class="mt-2">Desktops</h3>
            <p>The listed concession price is only available to concession card holders. Please have a valid concession card ready when you make your purchase, you may purchase a desktop computer without a concession card however you
                will be charged our full market price.</p>
            <div class="list-group" id="desktops">
                <!-- Content will be dynamically populated -->
            </div>
        </div>

        <!-- Laptops Section -->
        <div class="col-md-6">
            <h3 class="mt-2">Laptops</h3>
            <p>Laptops are first come, first served. You must have a valid concession card to purchase a laptop, and there is a one per person limit.</p>
            <div class="list-group" id="laptops">
                <!-- Content will be dynamically populated -->
            </div>
        </div>

        <ul id="products-list"></ul>
    </div>
    <p class="mt-4 text-muted">Each computer comes with Linux Mint (<%= company.name %> Edition), necessary accessories, and a 3-month warranty.</p>
    <p class="text-muted">Laptops are limited to one per person with a valid concession card.</p>
</main>

<%- include('partials/footer') %>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/api/stocklist')
            .then(response => response.json())
            .then(data => {
                const { desktops, laptops } = data;

                // Populate Desktops
                const desktopContainer = document.querySelector('#desktops');
                desktops.forEach(desktop => {
                    const item = `
                        <div class="list-group-item">
                            <h5 class="mb-1">${desktop.name} <small>(ID: ${desktop.id})</small></h5>
                            <p class="mb-1">Processor: ${desktop.processor}</p>
                            <p class="mb-1">Storage: ${desktop.storage}, RAM: ${desktop.ram}</p>
                            <p class="mb-1">Monitor: ${desktop.monitor}</p>
                            <p>Concession Price: $${desktop.concessionPrice}, Full Price: $${desktop.fullPrice}</p>
                        </div>`;
                    desktopContainer.insertAdjacentHTML('beforeend', item);
                });

                // Populate Laptops
                const laptopContainer = document.querySelector('#laptops');
                laptops.forEach(laptop => {
                    const item = `
                        <div class="list-group-item">
                            <h5 class="mb-1">${laptop.name} <small>(ID: ${laptop.id})</small></h5>
                            <p class="mb-1">Processor: ${laptop.processor}</p>
                            <p class="mb-1">Storage: ${laptop.storage}, RAM: ${laptop.ram}</p>
                            <p class="mb-1">Screen Size: ${laptop.screen}</p>
                            <p>Concession Price: $${laptop.concessionPrice}</p>
                        </div>`;
                    laptopContainer.insertAdjacentHTML('beforeend', item);
                });
            })
            .catch(err => {
                console.error('Failed to load stocklist:', err);
            });
    });
</script>

<script>
    fetch('<%= basePath %>api/products')
        .then(response => response.json())
        .then(data => {
            console.log('Products:', data.products);
            const container = document.getElementById('products-list');
            data.products.forEach(product => {
                const item = document.createElement('li');
                item.textContent = `${product.name} - $${product.price}`;
                container.appendChild(item);
            });
        })
        .catch(error => console.error('Error fetching data:', error));
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>